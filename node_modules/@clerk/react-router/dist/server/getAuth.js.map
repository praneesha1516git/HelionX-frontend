{"version":3,"sources":["../../src/server/getAuth.ts"],"sourcesContent":["import {\n  type AuthenticateRequestOptions,\n  type GetAuthFn,\n  getAuthObjectForAcceptedToken,\n} from '@clerk/backend/internal';\nimport type { PendingSessionOptions } from '@clerk/types';\nimport type { LoaderFunctionArgs } from 'react-router';\n\nimport { IsOptIntoMiddleware } from '../server/utils';\nimport { noLoaderArgsPassedInGetAuth } from '../utils/errors';\nimport { authFnContext } from './clerkMiddleware';\nimport { legacyAuthenticateRequest } from './legacyAuthenticateRequest';\nimport { loadOptions } from './loadOptions';\n\ntype GetAuthOptions = PendingSessionOptions & { acceptsToken?: AuthenticateRequestOptions['acceptsToken'] };\n\nexport const getAuth: GetAuthFn<LoaderFunctionArgs, true> = (async (\n  args: LoaderFunctionArgs,\n  opts?: GetAuthOptions,\n) => {\n  if (!args || (args && (!args.request || !args.context))) {\n    throw new Error(noLoaderArgsPassedInGetAuth);\n  }\n\n  const { acceptsToken, treatPendingAsSignedOut, ...restOptions } = opts || {};\n\n  // If the middleware is installed, use the auth function from the context\n  const authObjectFn = IsOptIntoMiddleware(args.context) && args.context.get(authFnContext);\n  if (authObjectFn) {\n    return getAuthObjectForAcceptedToken({\n      authObject: authObjectFn({ treatPendingAsSignedOut }),\n      acceptsToken,\n    });\n  }\n\n  // Fallback to the legacy authenticateRequest if the middleware is not installed\n  const loadedOptions = loadOptions(args, restOptions);\n  const requestState = await legacyAuthenticateRequest(args, {\n    ...loadedOptions,\n    acceptsToken: 'any',\n  });\n\n  const authObject = requestState.toAuth({ treatPendingAsSignedOut });\n\n  return getAuthObjectForAcceptedToken({ authObject, acceptsToken });\n}) as GetAuthFn<LoaderFunctionArgs, true>;\n"],"mappings":";AAAA;AAAA,EAGE;AAAA,OACK;AAIP,SAAS,2BAA2B;AACpC,SAAS,mCAAmC;AAC5C,SAAS,qBAAqB;AAC9B,SAAS,iCAAiC;AAC1C,SAAS,mBAAmB;AAIrB,IAAM,WAAgD,OAC3D,MACA,SACG;AACH,MAAI,CAAC,QAAS,SAAS,CAAC,KAAK,WAAW,CAAC,KAAK,UAAW;AACvD,UAAM,IAAI,MAAM,2BAA2B;AAAA,EAC7C;AAEA,QAAM,EAAE,cAAc,yBAAyB,GAAG,YAAY,IAAI,QAAQ,CAAC;AAG3E,QAAM,eAAe,oBAAoB,KAAK,OAAO,KAAK,KAAK,QAAQ,IAAI,aAAa;AACxF,MAAI,cAAc;AAChB,WAAO,8BAA8B;AAAA,MACnC,YAAY,aAAa,EAAE,wBAAwB,CAAC;AAAA,MACpD;AAAA,IACF,CAAC;AAAA,EACH;AAGA,QAAM,gBAAgB,YAAY,MAAM,WAAW;AACnD,QAAM,eAAe,MAAM,0BAA0B,MAAM;AAAA,IACzD,GAAG;AAAA,IACH,cAAc;AAAA,EAChB,CAAC;AAED,QAAM,aAAa,aAAa,OAAO,EAAE,wBAAwB,CAAC;AAElE,SAAO,8BAA8B,EAAE,YAAY,aAAa,CAAC;AACnE;","names":[]}