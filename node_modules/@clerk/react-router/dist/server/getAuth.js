// src/server/getAuth.ts
import {
  getAuthObjectForAcceptedToken
} from "@clerk/backend/internal";
import { IsOptIntoMiddleware } from "../server/utils.js";
import { noLoaderArgsPassedInGetAuth } from "../utils/errors.js";
import { authFnContext } from "./clerkMiddleware.js";
import { legacyAuthenticateRequest } from "./legacyAuthenticateRequest.js";
import { loadOptions } from "./loadOptions.js";
var getAuth = (async (args, opts) => {
  if (!args || args && (!args.request || !args.context)) {
    throw new Error(noLoaderArgsPassedInGetAuth);
  }
  const { acceptsToken, treatPendingAsSignedOut, ...restOptions } = opts || {};
  const authObjectFn = IsOptIntoMiddleware(args.context) && args.context.get(authFnContext);
  if (authObjectFn) {
    return getAuthObjectForAcceptedToken({
      authObject: authObjectFn({ treatPendingAsSignedOut }),
      acceptsToken
    });
  }
  const loadedOptions = loadOptions(args, restOptions);
  const requestState = await legacyAuthenticateRequest(args, {
    ...loadedOptions,
    acceptsToken: "any"
  });
  const authObject = requestState.toAuth({ treatPendingAsSignedOut });
  return getAuthObjectForAcceptedToken({ authObject, acceptsToken });
});
export {
  getAuth
};
//# sourceMappingURL=getAuth.js.map